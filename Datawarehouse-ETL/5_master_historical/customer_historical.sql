--snapshot of everyday
DELETE FROM master.customer_historical
WHERE date = current_date - 1;

INSERT INTO master.customer_historical
SELECT 
	customer_id,                            
    company_id,                             
    created_at,                             
    updated_at,                             
    subscription_limit,                     
    subscription_limit_change_date,         
    customer_type,                          
    company_name,                           
    company_status,                         
    company_type_name,                      
    company_created_at,                     
    billing_country,                        
    shipping_country,                       
    billing_city,                           
    billing_zip,                            
    shipping_city,                          
    shipping_zip,                           
    signup_language,                        
    default_locale,                         
    bundesland,                             
    referral_code,                          
    email_subscribe,                        
    initial_subscription_limit,             
    subscription_limit_defined_date,        
    customer_scoring_result,                
    burgel_score,                           
    burgel_score_details,                   
    burgel_person_known,                    
    burgel_address_details,                 
    verita_score,                           
    verita_person_known_at_address,         
    fraud_type,                             
    trust_type,                             
    min_fraud_detected,                     
    max_fraud_detected,                     
    schufa_class,                           
    orders,                                 
    completed_orders,                       
    paid_orders,                            
    declined_orders,                        
    last_order_created_date,                
    last_cart_product_names,                
    max_submitted_order_date,               
    delivered_allocations,                  
    returned_allocations,                   
    outstanding_purchase_price,             
    active_subscription_product_names,      
    active_subscription_subcategory,        
    active_subscription_category,           
    active_subscription_brand,              
    ever_rented_asset_purchase_price,       
    active_subscription_value,              
    committed_subscription_value,           
    active_subscriptions,                   
    subscription_revenue_due,               
    subscription_revenue_paid,              
    subscription_revenue_refunded,          
    subscription_revenue_chargeback,        
    payment_count,                          
    paid_subscriptions,                     
    refunded_subscriptions,                 
    failed_subscriptions,                   
    chargeback_subscriptions,               
    burgel_risk_category,                   
    subscriptions,                          
    start_date_of_first_subscription,       
    first_subscription_store,               
    first_subscription_acquisition_channel, 
    second_subscription_store,              
    subscription_durations,                 
    first_subscription_duration,            
    second_subscription_duration,           
    subs_wearables,                         
    subs_drones,                            
    subs_cameras,                           
    subs_phones_and_tablets,                
    subs_computers,                         
    subs_gaming,                            
    subs_audio,                             
    subs_other,                             
    first_subscription_product_category,    
    second_subscription_product_category,   
    ever_rented_products,                   
    ever_rented_sku,                        
    ever_rented_brands,                     
    ever_rented_subcategories,              
    ever_rented_categories,                 
    clv,                                    
    voucher_usage,                          
    minimum_cancellation_date,              
    minimum_cancellation_product,           
    subs_pag,                               
    subs_1m,                                
    subs_3m,                                
    subs_6m,                                
    subs_12m,                               
    subs_24m,                               
    is_bad_customer,                        
    customer_acquisition_cohort,            
    customer_acquisition_subscription_id,   
    customer_acquisition_rental_plan,       
    customer_acquisition_category_name,     
    customer_acquisition_subcategory_name,  
    customer_acquisition_product_brand,     
    rfm_score,                              
    rfm_segment,                            
    signup_country,                         
    max_cancellation_date,                  
    max_asset_delivered_at,                 
    crm_label,                              
    profile_status,                         
    age,                                    
    crm_label_braze,
    current_date - 1 AS date,
    ever_rented_variant_sku
FROM master.customer
WHERE created_at < current_date;

--removing duplicates
