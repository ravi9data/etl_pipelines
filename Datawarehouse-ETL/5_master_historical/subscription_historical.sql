--snapshot of everyday
DELETE FROM master.subscription_historical
WHERE date = current_date - 1;

INSERT INTO master.subscription_historical
SELECT 
subscription_id,
    subscription_sf_id,
    order_created_date,
    created_date,
    updated_date,
    start_date,
    rank_subscriptions,
    first_subscription_start_date,
    subscriptions_per_customer,
    customer_id,
    customer_type,
    customer_acquisition_cohort,
    subscription_limit,
    order_id,
    store_id,
    store_name,
    store_label,
    store_type,
    store_number,
    account_name,
    status,
    variant_sku,
    allocation_status,
    allocation_tries,
    cross_sale_attempts,
    replacement_attempts,
    allocated_assets,
    delivered_assets,
    returned_packages,
    returned_assets,
    outstanding_assets,
    outstanding_asset_value,
    outstanding_residual_asset_value,
    outstanding_rrp,
    first_asset_delivery_date,
    last_return_shipment_at,
    subscription_plan,
    rental_period,
    subscription_value,
    subscription_value_euro,
    reporting_subscription_value_euro,
    committed_sub_value,
    next_due_date,
    commited_sub_revenue_future,
    currency,
    subscription_duration,
    effective_duration,
    outstanding_duration,
    months_required_TO_OWN,
    max_payment_number,
    payment_count,
    paid_subscriptions,
    last_valid_payment_category,
    dpd,
    subscription_revenue_due,
    subscription_revenue_paid,
    outstanding_subscription_revenue,
    subscription_revenue_refunded,
    subscription_revenue_chargeback,
    net_subscription_revenue_paid,
    cancellation_date,
    cancellation_note,
    cancellation_reason,
    cancellation_reason_new,
    cancellation_reason_churn,
    is_widerruf,
    payment_method,
    debt_collection_handover_date,  
    dc_status,
    result_debt_collection_contact,
    avg_asset_purchase_price,
    product_sku,
    product_name,
    category_name,
    subcategory_name,
    brand,
    new_recurring,
    retention_group,
    minimum_cancellation_date,
    minimum_term_months,
    asset_cashflow_from_old_subscriptions,
    exposure_to_default,
    mietkauf_amount_overpayment,
    is_eligible_for_mietkauf,
    trial_days,
    trial_variant,
    is_not_triggered_payments,
    asset_recirculation_status,
    store_short,
    country_name,
    store_commercial,
    subscription_bo_id,
    buyout_disabled,
    buyout_disabled_at,
    buyout_disabled_reason,
    original_subscription_value ,
    original_subscription_value_euro,
    free_year_offer_start_date,
    reactivated_date,
    additional_committed_sub_value,
    state,
    current_date - 1 AS date
FROM master.subscription
WHERE created_date < current_date;

