BEGIN;

DELETE FROM stg_external_apis.ixopay_transactions
WHERE uuid IN (SELECT DISTINCT uuid FROM stg_external_apis_dl.ixopay_transactions);

INSERT INTO stg_external_apis.ixopay_transactions(
    uuid,
    tenant_guid,
    tenant_name,
    master_tenant,
    merchant_guid,
    merchant_name,
    connector_guid,
    connector_name,
    provider_guid,
    provider_name,
    purchase_id,
    test_mode,
    related_id,
    broker_id,
    meta_connector_guid,
    meta_connector_name,
    adapter,
    method,
    "type",
    "status",
    created_at,
    modified_at,
    initiated_by,
    merchant_txid,
    adapter_txid,
    adapter_token,
    adapter_processor_txid,
    additional_id1,
    additional_id2,
    amount,
    currency,
    base_amount,
    base_currency,
    "description",
    statement_descriptor,
    extra_data,
    callback_extra_data,
    buyer_country,
    buyer_country_geopoint,
    "3d_secure",
    transaction_indicator,
    incoming_settlement_state,
    outgoing_settlement_state,
    invoiceable,
    reconciliation_state,
    settlement_amount,
    settlement_currency,
    settlement_date,
    settlement_exchange_rate,
    is_recurring,
    registered_at,
    is_chargedback,
    chargedback_at,
    is_charged_reversed,
    chargeback_reversed_at,
    is_with_register,
    is_refunded,
    attempt,
    is_postback_delivered,
    return_data,
    items,
    fees,
    customer,
    creditcard,
    errors,
    status_history,
    postprocessing
)
SELECT
    uuid,
    tenant_guid,
    tenant_name,
    master_tenant,
    merchant_guid,
    merchant_name,
    connector_guid,
    connector_name,
    provider_guid,
    provider_name,
    purchase_id,
    test_mode,
    related_id,
    broker_id,
    meta_connector_guid,
    meta_connector_name,
    adapter,
    method,
    "type",
    "status",
    created_at,
    modified_at,
    initiated_by,
    merchant_txid,
    adapter_txid,
    adapter_token,
    adapter_processor_txid,
    additional_id1,
    additional_id2,
    amount,
    currency,
    base_amount,
    base_currency,
    "description",
    statement_descriptor,
    extra_data,
    callback_extra_data,
    buyer_country,
    buyer_country_geopoint,
    "3d_secure",
    transaction_indicator,
    incoming_settlement_state,
    outgoing_settlement_state,
    invoiceable,
    reconciliation_state,
    settlement_amount,
    settlement_currency,
    settlement_date,
    settlement_exchange_rate,
    is_recurring,
    registered_at,
    is_chargedback,
    chargedback_at,
    is_charged_reversed,
    chargeback_reversed_at,
    is_with_register,
    is_refunded,
    attempt,
    is_postback_delivered,
    return_data,
    items,
    fees,
    customer,
    creditcard,
    errors,
    status_history,
    postprocessing
FROM stg_external_apis_dl.ixopay_transactions;

COMMIT;
