BEGIN;
DELETE FROM stg_external_apis.us_inventory_info WHERE received_at::date='{{ ti.xcom_pull(task_ids='date_time_extraction_from_filename')}}'::DATE;

INSERT INTO stg_external_apis.us_inventory_info(
    received_at,
    inserted_at,
    account,
    item_number,
    item_description,
    warehouse,
    location,
    onhand_qty,
    reserved_qty,
    available_qty,
    vendor_serial,
    vendor_lot,
    lpn,
    designator,
    revision,
    expiration_date,
    hazard_class,
    cost,
    date_received_gmt,
    invoice_po_no,
    rma_no,
    supplier_vendor,
    location_plant_id,
    country_territory_of_origin,
    part_condition_type,
    po_line_order_line,
    date_of_repair,
    date_of_manufacture,
    storage_location,
    fiscal_note,
    rec_ref_1,
    rec_ref_2,
    rec_ref_3,
    rec_ref_4,
    rec_ref_5,
    rec_ref_6,
    rec_ref_7,
    rec_ref_8,
    rec_ref_9,
    rec_ref_10,
    rec_ref_11,
    rec_ref_12,
    rec_ref_13,
    rec_ref_14,
    rec_ref_15,
    rec_ref_16,
    rec_ref_17,
    rec_ref_18,
    rec_ref_19,
    rec_ref_20,
    attribute_1,
    attribute_2,
    attribute_3,
    attribute_4,
    attribute_5,
    attribute_6,
    attribute_7,
    attribute_8,
    attribute_9,
    attribute_10,
    attribute_11,
    attribute_12,
    attribute_13,
    attribute_14,
    attribute_15,
    attribute_16,
    attribute_17,
    attribute_18,
    attribute_19,
    attribute_20
)
SELECT '{{ ti.xcom_pull(task_ids='date_time_extraction_from_filename')}}' AS received_at,
        sysdate AS inserted_at,
        account,
        item_number,
        item_description,
        warehouse,
        location,
        onhand_qty,
        reserved_qty,
        available_qty,
        vendor_serial,
        vendor_lot,
        lpn,
        designator,
        revision,
        expiration_date,
        hazard_class,
        cost,
        date_received_gmt,
        invoice_po_no,
        rma_no,
        supplier_vendor,
        location_plant_id,
        country_territory_of_origin,
        part_condition_type,
        po_line_order_line,
        date_of_repair,
        date_of_manufacture,
        storage_location,
        fiscal_note,
        rec_ref_1,
        rec_ref_2,
        rec_ref_3,
        rec_ref_4,
        rec_ref_5,
        rec_ref_6,
        rec_ref_7,
        rec_ref_8,
        rec_ref_9,
        rec_ref_10,
        rec_ref_11,
        rec_ref_12,
        rec_ref_13,
        rec_ref_14,
        rec_ref_15,
        rec_ref_16,
        rec_ref_17,
        rec_ref_18,
        rec_ref_19,
        rec_ref_20,
        attribute_1,
        attribute_2,
        attribute_3,
        attribute_4,
        attribute_5,
        attribute_6,
        attribute_7,
        attribute_8,
        attribute_9,
        attribute_10,
        attribute_11,
        attribute_12,
        attribute_13,
        attribute_14,
        attribute_15,
        attribute_16,
        attribute_17,
        attribute_18,
        attribute_19,
        attribute_20 
FROM stg_external_apis_dl.us_inventory;
COMMIT;
